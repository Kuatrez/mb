<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ—Ä—Å–∫–æ–π –ë–æ–π - –°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary: #3b82f6;
            --primary-dark: #2563eb;
            --secondary: #64748b;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --background: #0f172a;
            --surface: #1e293b;
            --surface-light: #334155;
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            --border: #475569;
            --shadow: rgba(0, 0, 0, 0.25);
            --glow: rgba(59, 130, 246, 0.3);
            --grid-size: min(40px, 8vw);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--success));
            border-radius: 2px;
        }

        .title {
            font-size: clamp(2rem, 5vw, 3.5rem);
            font-weight: 700;
            background: linear-gradient(135deg, #3b82f6, #06b6d4, #10b981);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            text-shadow: 0 0 30px var(--glow);
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
            font-weight: 400;
        }

        .game-layout {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 30px;
            flex: 1;
        }

        @media (max-width: 1024px) {
            .game-layout {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }

        .game-area {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .boards-container {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
        }

        .board-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .board-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            background: var(--surface);
            border-radius: 25px;
            border: 1px solid var(--border);
            box-shadow: 0 4px 15px var(--shadow);
        }

        .board-title i {
            font-size: 1.1rem;
        }

        .player-board .board-title {
            background: linear-gradient(135deg, var(--success), #059669);
        }

        .enemy-board .board-title {
            background: linear-gradient(135deg, var(--danger), #dc2626);
        }

        .game-board {
            display: grid;
            grid-template-columns: repeat(10, var(--grid-size));
            grid-template-rows: repeat(10, var(--grid-size));
            gap: 2px;
            padding: 15px;
            background: var(--surface);
            border-radius: 15px;
            border: 2px solid var(--border);
            box-shadow: 0 8px 25px var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .game-board::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 49%, rgba(255,255,255,0.03) 50%, transparent 51%);
            pointer-events: none;
        }

        .cell {
            width: var(--grid-size);
            height: var(--grid-size);
            background: var(--surface-light);
            border-radius: 6px;
            cursor: pointer;
            position: relative;
            transition: all 0.2s ease;
            border: 1px solid transparent;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .cell:hover {
            transform: scale(1.05);
            border-color: var(--primary);
            box-shadow: 0 0 15px var(--glow);
        }

        .cell.ship {
            background: linear-gradient(135deg, var(--success), #059669);
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.4);
        }

        .cell.hit {
            background: linear-gradient(135deg, var(--warning), #d97706);
            animation: hit-pulse 0.6s ease;
        }

        .cell.hit::after {
            content: 'üí•';
            font-size: 0.8rem;
        }

        .cell.miss {
            background: linear-gradient(135deg, var(--secondary), #475569);
            position: relative;
        }

        .cell.miss::after {
            content: 'üíß';
            font-size: 0.7rem;
        }

        .cell.sunk {
            background: linear-gradient(135deg, var(--danger), #dc2626);
            animation: sunk-pulse 0.8s ease;
        }

        .cell.sunk::after {
            content: 'üíÄ';
            font-size: 0.8rem;
        }

        @keyframes hit-pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); box-shadow: 0 0 20px rgba(245, 158, 11, 0.8); }
            100% { transform: scale(1); }
        }

        @keyframes sunk-pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.15); box-shadow: 0 0 25px rgba(239, 68, 68, 0.8); }
            100% { transform: scale(1); }
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .panel {
            background: var(--surface);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid var(--border);
            box-shadow: 0 8px 25px var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--success));
        }

        .panel-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .game-status {
            text-align: center;
            margin-bottom: 20px;
        }

        .status-main {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .status-sub {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .turn-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
            margin: 10px 0;
        }

        .turn-indicator.player {
            background: linear-gradient(135deg, var(--success), #059669);
        }

        .turn-indicator.ai {
            background: linear-gradient(135deg, var(--danger), #dc2626);
        }

        .ships-rack {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .ship-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px;
            background: var(--surface-light);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }

        .ship-item:hover {
            transform: translateX(5px);
            border-color: var(--primary);
            box-shadow: 0 4px 15px var(--glow);
        }

        .ship-item.used {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .ship-item.selected {
            border-color: var(--primary);
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        }

        .ship-size-indicator {
            font-weight: 700;
            font-size: 1.1rem;
            min-width: 25px;
        }

        .ship-visual {
            display: flex;
            gap: 3px;
        }

        .ship-segment {
            width: 16px;
            height: 16px;
            background: linear-gradient(135deg, var(--success), #059669);
            border-radius: 3px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .control-row {
            display: flex;
            gap: 10px;
        }

        .btn {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
        }

        .btn-secondary {
            background: var(--surface-light);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--border);
            transform: translateY(-1px);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #dc2626);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4);
        }

        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 15px 0;
        }

        .stat-item {
            text-align: center;
            padding: 12px;
            background: var(--surface-light);
            border-radius: 8px;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 4px;
        }

        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 15px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .game-log {
            max-height: 300px;
            overflow-y: auto;
            padding: 15px;
            background: var(--surface-light);
            border-radius: 10px;
            font-size: 0.85rem;
            line-height: 1.4;
        }

        .log-entry {
            padding: 6px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            animation: fadeIn 0.3s ease;
        }

        .log-entry:last-child {
            border-bottom: none;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .victory-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .victory-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .victory-content {
            background: var(--surface);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            border: 2px solid var(--border);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            transform: scale(0.8);
            transition: transform 0.3s ease;
        }

        .victory-modal.show .victory-content {
            transform: scale(1);
        }

        .victory-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .victory-title.win {
            background: linear-gradient(135deg, var(--success), #059669);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .victory-title.lose {
            background: linear-gradient(135deg, var(--danger), #dc2626);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .boards-container {
                flex-direction: column;
                align-items: center;
                gap: 20px;
            }

            .control-row {
                flex-direction: column;
            }

            .stats {
                grid-template-columns: 1fr;
            }

            :root {
                --grid-size: min(35px, 7vw);
            }
        }

        @media (max-width: 480px) {
            :root {
                --grid-size: min(30px, 6vw);
            }

            .panel {
                padding: 15px;
            }

            .title {
                font-size: 2rem;
            }
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏ */
        .loading {
            opacity: 0;
            animation: fadeInUp 0.6s ease forwards;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–∫—Ä–æ–ª–ª–±–∞—Ä–∞ */
        .game-log::-webkit-scrollbar {
            width: 6px;
        }

        .game-log::-webkit-scrollbar-track {
            background: var(--surface);
            border-radius: 3px;
        }

        .game-log::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }

        .game-log::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header loading">
            <h1 class="title">‚öì –ú–æ—Ä—Å–∫–æ–π –ë–æ–π</h1>
            <p class="subtitle">–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–π –∏–≥—Ä—ã</p>
        </header>

        <div class="game-layout">
            <div class="game-area loading">
                <div class="boards-container">
                    <div class="board-section player-board">
                        <div class="board-title">
                            <i class="fas fa-shield-alt"></i>
                            –í–∞—à–µ –ø–æ–ª–µ
                        </div>
                        <div id="playerBoard" class="game-board"></div>
                    </div>

                    <div class="board-section enemy-board">
                        <div class="board-title">
                            <i class="fas fa-crosshairs"></i>
                            –ü–æ–ª–µ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞
                        </div>
                        <div id="enemyBoard" class="game-board"></div>
                    </div>
                </div>
            </div>

            <aside class="sidebar loading">
                <div class="panel">
                    <div class="panel-title">
                        <i class="fas fa-gamepad"></i>
                        –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–π
                    </div>
                    
                    <div class="game-status">
                        <div id="gameState" class="status-main">–†–∞–∑–º–µ—â–µ–Ω–∏–µ –∫–æ—Ä–∞–±–ª–µ–π</div>
                        <div id="subState" class="status-sub">–†–∞–∑–º–µ—Å—Ç–∏—Ç–µ –≤—Å–µ –∫–æ—Ä–∞–±–ª–∏ –Ω–∞ –ø–æ–ª–µ</div>
                        <div id="turnIndicator" class="turn-indicator" style="display: none;">
                            <i class="fas fa-user"></i>
                            –í–∞—à —Ö–æ–¥
                        </div>
                    </div>

                    <div class="stats">
                        <div class="stat-item">
                            <div id="sunkCount" class="stat-value">0</div>
                            <div class="stat-label">–ü–æ—Ç–æ–ø–ª–µ–Ω–æ</div>
                        </div>
                        <div class="stat-item">
                            <div id="totalShips" class="stat-value">10</div>
                            <div class="stat-label">–í—Å–µ–≥–æ –∫–æ—Ä–∞–±–ª–µ–π</div>
                        </div>
                    </div>

                    <div class="controls">
                        <div class="control-row">
                            <button id="startBtn" class="btn btn-primary">
                                <i class="fas fa-play"></i>
                                –ù–∞—á–∞—Ç—å –∏–≥—Ä—É
                            </button>
                        </div>
                        <div class="control-row">
                            <button id="randomBtn" class="btn btn-secondary">
                                <i class="fas fa-random"></i>
                                –°–ª—É—á–∞–π–Ω–æ
                            </button>
                            <button id="clearBtn" class="btn btn-secondary">
                                <i class="fas fa-eraser"></i>
                                –°–±—Ä–æ—Å
                            </button>
                        </div>
                        <div class="control-row">
                            <button id="rotateBtn" class="btn btn-secondary">
                                <i class="fas fa-redo"></i>
                                –ü–æ–≤–µ—Ä–Ω—É—Ç—å
                            </button>
                            <button id="restartBtn" class="btn btn-danger">
                                <i class="fas fa-refresh"></i>
                                –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
                            </button>
                        </div>
                    </div>
                </div>

                <div class="panel">
                    <div class="panel-title">
                        <i class="fas fa-ship"></i>
                        –ö–æ—Ä–∞–±–ª–∏ –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è
                    </div>
                    <div id="shipsList" class="ships-rack"></div>
                    
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background: linear-gradient(135deg, var(--success), #059669);"></div>
                            –ö–æ—Ä–∞–±–ª—å
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: linear-gradient(135deg, var(--warning), #d97706);"></div>
                            –ü–æ–ø–∞–¥–∞–Ω–∏–µ
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: linear-gradient(135deg, var(--secondary), #475569);"></div>
                            –ú–∏–º–æ
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: linear-gradient(135deg, var(--danger), #dc2626);"></div>
                            –ü–æ—Ç–æ–ø–ª–µ–Ω
                        </div>
                    </div>
                </div>

                <div class="panel">
                    <div class="panel-title">
                        <i class="fas fa-history"></i>
                        –ñ—É—Ä–Ω–∞–ª –∏–≥—Ä—ã
                    </div>
                    <div id="gameLog" class="game-log">
                        <div class="log-entry">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ú–æ—Ä—Å–∫–æ–π –±–æ–π!</div>
                        <div class="log-entry">–†–∞–∑–º–µ—Å—Ç–∏—Ç–µ –∫–æ—Ä–∞–±–ª–∏ –Ω–∞ —Å–≤–æ–µ–º –ø–æ–ª–µ</div>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–±–µ–¥—ã/–ø–æ—Ä–∞–∂–µ–Ω–∏—è -->
    <div id="victoryModal" class="victory-modal">
        <div class="victory-content">
            <div id="victoryTitle" class="victory-title">üéâ –ü–æ–±–µ–¥–∞!</div>
            <p id="victoryMessage">–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –ø–æ—Ç–æ–ø–∏–ª–∏ –≤—Å–µ –∫–æ—Ä–∞–±–ª–∏ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞!</p>
            <button id="playAgainBtn" class="btn btn-primary" style="margin-top: 20px;">
                <i class="fas fa-play"></i>
                –ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞
            </button>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏–≥—Ä—ã
        const BOARD_SIZE = 10;
        const SHIPS_CONFIG = [4, 3, 3, 2, 2, 2, 1, 1, 1, 1];
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const playerBoardEl = document.getElementById('playerBoard');
        const enemyBoardEl = document.getElementById('enemyBoard');
        const shipsListEl = document.getElementById('shipsList');
        const gameStateEl = document.getElementById('gameState');
        const subStateEl = document.getElementById('subState');
        const turnIndicatorEl = document.getElementById('turnIndicator');
        const sunkCountEl = document.getElementById('sunkCount');
        const gameLogEl = document.getElementById('gameLog');
        const victoryModalEl = document.getElementById('victoryModal');
        const victoryTitleEl = document.getElementById('victoryTitle');
        const victoryMessageEl = document.getElementById('victoryMessage');
        
        // –ö–Ω–æ–ø–∫–∏
        const startBtn = document.getElementById('startBtn');
        const randomBtn = document.getElementById('randomBtn');
        const clearBtn = document.getElementById('clearBtn');
        const rotateBtn = document.getElementById('rotateBtn');
        const restartBtn = document.getElementById('restartBtn');
        const playAgainBtn = document.getElementById('playAgainBtn');

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        let gameState = {
            playerGrid: [],
            enemyGrid: [],
            playerShips: [],
            enemyShips: [],
            isPlacing: true,
            selectedShipIndex: null,
            shipOrientation: 'horizontal', // 'horizontal' –∏–ª–∏ 'vertical'
            gameStarted: false,
            isPlayerTurn: true,
            enemySunkCount: 0,
            playerSunkCount: 0
        };

        // –ò–ò —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        let aiState = {
            mode: 'hunt', // 'hunt' –∏–ª–∏ 'target'
            targets: [],
            lastHit: null,
            hits: []
        };

        // –£—Ç–∏–ª–∏—Ç—ã
        function coordToIndex(row, col) {
            return row * BOARD_SIZE + col;
        }

        function indexToCoord(index) {
            return [Math.floor(index / BOARD_SIZE), index % BOARD_SIZE];
        }

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function addLogEntry(message) {
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
            gameLogEl.insertBefore(entry, gameLogEl.firstChild);
            
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
            if (gameLogEl.children.length > 50) {
                gameLogEl.removeChild(gameLogEl.lastChild);
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä–æ–≤—ã—Ö –ø–æ–ª–µ–π
        function createBoard(container, prefix) {
            container.innerHTML = '';
            for (let i = 0; i < BOARD_SIZE * BOARD_SIZE; i++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.dataset.index = i;
                cell.id = `${prefix}-${i}`;
                container.appendChild(cell);
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –∫–æ—Ä–∞–±–ª—è
        function canPlaceShip(grid, row, col, length, orientation) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥—Ä–∞–Ω–∏—Ü—ã
            if (orientation === 'horizontal') {
                if (col + length > BOARD_SIZE) return false;
            } else {
                if (row + length > BOARD_SIZE) return false;
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–Ω—è—Ç–æ—Å—Ç—å –∫–ª–µ—Ç–æ–∫ –∏ —Å–æ—Å–µ–¥–Ω–∏–µ –∫–ª–µ—Ç–∫–∏
            for (let i = Math.max(0, row - 1); i <= Math.min(BOARD_SIZE - 1, orientation === 'vertical' ? row + length : row + 1); i++) {
                for (let j = Math.max(0, col - 1); j <= Math.min(BOARD_SIZE - 1, orientation === 'horizontal' ? col + length : col + 1); j++) {
                    if (grid[coordToIndex(i, j)] === 1) return false;
                }
            }

            return true;
        }

        // –†–∞–∑–º–µ—â–µ–Ω–∏–µ –∫–æ—Ä–∞–±–ª—è
        function placeShip(grid, ships, shipIndex, row, col, length, orientation) {
            const coords = [];
            
            if (orientation === 'horizontal') {
                for (let j = col; j < col + length; j++) {
                    const index = coordToIndex(row, j);
                    grid[index] = 1;
                    coords.push(index);
                }
            } else {
                for (let i = row; i < row + length; i++) {
                    const index = coordToIndex(i, col);
                    grid[index] = 1;
                    coords.push(index);
                }
            }

            ships[shipIndex] = {
                length: length,
                coords: coords,
                hits: 0,
                sunk: false
            };
        }

        // –°–ª—É—á–∞–π–Ω–æ–µ —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ –∫–æ—Ä–∞–±–ª–µ–π
        function randomPlacement(grid, ships) {
            // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ
            grid.fill(0);
            ships.length = 0;

            const shipIndices = Array.from({length: SHIPS_CONFIG.length}, (_, i) => i);
            shuffle(shipIndices);

            for (const shipIndex of shipIndices) {
                const length = SHIPS_CONFIG[shipIndex];
                let placed = false;
                let attempts = 0;

                while (!placed && attempts < 1000) {
                    const row = Math.floor(Math.random() * BOARD_SIZE);
                    const col = Math.floor(Math.random() * BOARD_SIZE);
                    const orientation = Math.random() < 0.5 ? 'horizontal' : 'vertical';

                    if (canPlaceShip(grid, row, col, length, orientation)) {
                        placeShip(grid, ships, shipIndex, row, col, length, orientation);
                        placed = true;
                    }
                    attempts++;
                }

                if (!placed) {
                    // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å, –Ω–∞—á–∏–Ω–∞–µ–º –∑–∞–Ω–æ–≤–æ
                    randomPlacement(grid, ships);
                    return;
                }
            }
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∏–≥—Ä–æ–≤—ã—Ö –ø–æ–ª–µ–π
        function renderBoards() {
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –ø–æ–ª—è –∏–≥—Ä–æ–∫–∞
            for (let i = 0; i < BOARD_SIZE * BOARD_SIZE; i++) {
                const cell = document.getElementById(`player-${i}`);
                cell.className = 'cell';
                
                if (gameState.playerGrid[i] === 1) cell.classList.add('ship');
                if (gameState.playerGrid[i] === 2) cell.classList.add('miss');
                if (gameState.playerGrid[i] === 3) cell.classList.add('hit');
                if (gameState.playerGrid[i] === 4) cell.classList.add('sunk');
            }

            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –ø–æ–ª—è –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞
            for (let i = 0; i < BOARD_SIZE * BOARD_SIZE; i++) {
                const cell = document.getElementById(`enemy-${i}`);
                cell.className = 'cell';
                
                if (gameState.enemyGrid[i] === 2) cell.classList.add('miss');
                if (gameState.enemyGrid[i] === 3) cell.classList.add('hit');
                if (gameState.enemyGrid[i] === 4) cell.classList.add('sunk');
            }
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–ø–∏—Å–∫–∞ –∫–æ—Ä–∞–±–ª–µ–π
        function renderShipsList() {
            shipsListEl.innerHTML = '';
            
            SHIPS_CONFIG.forEach((length, index) => {
                const isUsed = gameState.playerShips[index] != null;
                const isSelected = gameState.selectedShipIndex === index;
                
                const shipItem = document.createElement('div');
                shipItem.className = 'ship-item';
                if (isUsed) shipItem.classList.add('used');
                if (isSelected) shipItem.classList.add('selected');
                
                shipItem.innerHTML = `
                    <div class="ship-size-indicator">${length}</div>
                    <div class="ship-visual">
                        ${Array(length).fill().map(() => '<div class="ship-segment"></div>').join('')}
                    </div>
                `;
                
                if (!isUsed) {
                    shipItem.addEventListener('click', () => {
                        gameState.selectedShipIndex = index;
                        renderShipsList();
                        addLogEntry(`–í—ã–±—Ä–∞–Ω –∫–æ—Ä–∞–±–ª—å –¥–ª–∏–Ω–æ–π ${length} –ø–∞–ª—É–±`);
                    });
                }
                
                shipsListEl.appendChild(shipItem);
            });
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –ø–æ –ø–æ–ª—é –∏–≥—Ä–æ–∫–∞ (—Ä–∞–∑–º–µ—â–µ–Ω–∏–µ –∫–æ—Ä–∞–±–ª–µ–π)
        function handlePlayerBoardClick(event) {
            if (!gameState.isPlacing || gameState.selectedShipIndex === null) {
                if (gameState.selectedShipIndex === null) {
                    addLogEntry('–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ—Ä–∞–±–ª—å –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è');
                }
                return;
            }

            const cellIndex = parseInt(event.target.dataset.index);
            const [row, col] = indexToCoord(cellIndex);
            const shipLength = SHIPS_CONFIG[gameState.selectedShipIndex];

            if (canPlaceShip(gameState.playerGrid, row, col, shipLength, gameState.shipOrientation)) {
                placeShip(gameState.playerGrid, gameState.playerShips, gameState.selectedShipIndex, row, col, shipLength, gameState.shipOrientation);
                addLogEntry(`–ö–æ—Ä–∞–±–ª—å –¥–ª–∏–Ω–æ–π ${shipLength} –ø–∞–ª—É–± —Ä–∞–∑–º–µ—â–µ–Ω`);
                
                gameState.selectedShipIndex = null;
                renderShipsList();
                renderBoards();
                checkAllShipsPlaced();
            } else {
                addLogEntry('–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –∫–æ—Ä–∞–±–ª—å –≤ —ç—Ç–æ–º –º–µ—Å—Ç–µ');
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –ø–æ –ø–æ–ª—é –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ (—Å—Ç—Ä–µ–ª—å–±–∞)
        function handleEnemyBoardClick(event) {
            if (!gameState.gameStarted || !gameState.isPlayerTurn) return;

            const cellIndex = parseInt(event.target.dataset.index);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —Å—Ç—Ä–µ–ª—è–ª–∏ –ª–∏ —É–∂–µ –≤ —ç—Ç—É –∫–ª–µ—Ç–∫—É
            if (gameState.enemyGrid[cellIndex] === 2 || gameState.enemyGrid[cellIndex] === 3 || gameState.enemyGrid[cellIndex] === 4) {
                return;
            }

            playerShoot(cellIndex);
        }

        // –°—Ç—Ä–µ–ª—å–±–∞ –∏–≥—Ä–æ–∫–∞
        function playerShoot(cellIndex) {
            const [row, col] = indexToCoord(cellIndex);
            
            if (gameState.enemyGrid[cellIndex] === 1) {
                // –ü–æ–ø–∞–¥–∞–Ω–∏–µ
                gameState.enemyGrid[cellIndex] = 3;
                addLogEntry(`–ü–æ–ø–∞–¥–∞–Ω–∏–µ –≤ ${String.fromCharCode(65 + col)}${row + 1}!`);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ—Ç–æ–ø–ª–µ–Ω–∏–µ –∫–æ—Ä–∞–±–ª—è
                checkShipSunk(gameState.enemyShips, cellIndex, 'enemy');
                renderBoards();
                
                if (checkVictory()) return;
                
                // –ò–≥—Ä–æ–∫ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ö–æ–¥ –ø—Ä–∏ –ø–æ–ø–∞–¥–∞–Ω–∏–∏
                addLogEntry('–í–∞—à —Ö–æ–¥ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è!');
            } else {
                // –ü—Ä–æ–º–∞—Ö
                gameState.enemyGrid[cellIndex] = 2;
                addLogEntry(`–ü—Ä–æ–º–∞—Ö –≤ ${String.fromCharCode(65 + col)}${row + 1}`);
                
                // –ü–µ—Ä–µ–¥–∞–µ–º —Ö–æ–¥ –ò–ò
                gameState.isPlayerTurn = false;
                updateTurnIndicator();
                renderBoards();
                
                setTimeout(aiTurn, 1000);
            }
        }

        // –•–æ–¥ –ò–ò
        function aiTurn() {
            if (!gameState.gameStarted || gameState.isPlayerTurn) return;

            const targetIndex = aiChooseTarget();
            const [row, col] = indexToCoord(targetIndex);

            if (gameState.playerGrid[targetIndex] === 1) {
                // –ü–æ–ø–∞–¥–∞–Ω–∏–µ
                gameState.playerGrid[targetIndex] = 3;
                addLogEntry(`–ò–ò –ø–æ–ø–∞–ª –≤ ${String.fromCharCode(65 + col)}${row + 1}!`);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ò–ò
                aiState.mode = 'target';
                aiState.lastHit = targetIndex;
                aiState.hits.push(targetIndex);
                
                checkShipSunk(gameState.playerShips, targetIndex, 'player');
                renderBoards();
                
                if (checkVictory()) return;
                
                // –ò–ò –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ö–æ–¥ –ø—Ä–∏ –ø–æ–ø–∞–¥–∞–Ω–∏–∏
                setTimeout(aiTurn, 1200);
            } else {
                // –ü—Ä–æ–º–∞—Ö
                gameState.playerGrid[targetIndex] = 2;
                addLogEntry(`–ò–ò –ø—Ä–æ–º–∞—Ö–Ω—É–ª—Å—è –≤ ${String.fromCharCode(65 + col)}${row + 1}`);
                
                // –ü–µ—Ä–µ–¥–∞–µ–º —Ö–æ–¥ –∏–≥—Ä–æ–∫—É
                gameState.isPlayerTurn = true;
                updateTurnIndicator();
                renderBoards();
            }
        }

        // –ò–ò –≤—ã–±–∏—Ä–∞–µ—Ç —Ü–µ–ª—å
        function aiChooseTarget() {
            if (aiState.mode === 'target' && aiState.hits.length > 0) {
                const candidates = [];
                const directions = [[0, 1], [0, -1], [1, 0], [-1, 0]];
                
                // –ï—Å–ª–∏ –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ø–∞–¥–∞–Ω–∏–π, –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ—Ä–∞–±–ª—è
                if (aiState.hits.length >= 2) {
                    const lastTwo = aiState.hits.slice(-2);
                    const [r1, c1] = indexToCoord(lastTwo[0]);
                    const [r2, c2] = indexToCoord(lastTwo[1]);
                    
                    if (r1 === r2) {
                        // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π –∫–æ—Ä–∞–±–ª—å
                        const minC = Math.min(c1, c2);
                        const maxC = Math.max(c1, c2);
                        
                        if (minC > 0) {
                            const leftIndex = coordToIndex(r1, minC - 1);
                            if (gameState.playerGrid[leftIndex] === 0) candidates.push(leftIndex);
                        }
                        if (maxC < BOARD_SIZE - 1) {
                            const rightIndex = coordToIndex(r1, maxC + 1);
                            if (gameState.playerGrid[rightIndex] === 0) candidates.push(rightIndex);
                        }
                    } else if (c1 === c2) {
                        // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π –∫–æ—Ä–∞–±–ª—å
                        const minR = Math.min(r1, r2);
                        const maxR = Math.max(r1, r2);
                        
                        if (minR > 0) {
                            const topIndex = coordToIndex(minR - 1, c1);
                            if (gameState.playerGrid[topIndex] === 0) candidates.push(topIndex);
                        }
                        if (maxR < BOARD_SIZE - 1) {
                            const bottomIndex = coordToIndex(maxR + 1, c1);
                            if (gameState.playerGrid[bottomIndex] === 0) candidates.push(bottomIndex);
                        }
                    }
                }
                
                // –ï—Å–ª–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ, —Å—Ç—Ä–µ–ª—è–µ–º –≤–æ–∫—Ä—É–≥ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø–æ–ø–∞–¥–∞–Ω–∏—è
                if (candidates.length === 0) {
                    const [lastRow, lastCol] = indexToCoord(aiState.lastHit);
                    
                    for (const [dr, dc] of directions) {
                        const newRow = lastRow + dr;
                        const newCol = lastCol + dc;
                        
                        if (newRow >= 0 && newRow < BOARD_SIZE && newCol >= 0 && newCol < BOARD_SIZE) {
                            const newIndex = coordToIndex(newRow, newCol);
                            if (gameState.playerGrid[newIndex] === 0) {
                                candidates.push(newIndex);
                            }
                        }
                    }
                }
                
                if (candidates.length > 0) {
                    return candidates[Math.floor(Math.random() * candidates.length)];
                }
                
                // –ï—Å–ª–∏ —Ü–µ–ª–µ–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ —Ä–µ–∂–∏–º –æ—Ö–æ—Ç—ã
                aiState.mode = 'hunt';
                aiState.hits = [];
                aiState.lastHit = null;
            }
            
            // –†–µ–∂–∏–º –æ—Ö–æ—Ç—ã - —Å—Ç—Ä–µ–ª—è–µ–º –ø–æ —à–∞—Ö–º–∞—Ç–Ω–æ–π –¥–æ—Å–∫–µ
            const huntTargets = [];
            for (let i = 0; i < BOARD_SIZE * BOARD_SIZE; i++) {
                if (gameState.playerGrid[i] === 0) {
                    const [row, col] = indexToCoord(i);
                    if ((row + col) % 2 === 0) {
                        huntTargets.push(i);
                    }
                }
            }
            
            if (huntTargets.length === 0) {
                // –ï—Å–ª–∏ —à–∞—Ö–º–∞—Ç–Ω—ã—Ö –∫–ª–µ—Ç–æ–∫ –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å, —Å—Ç—Ä–µ–ª—è–µ–º –ø–æ –ª—é–±—ã–º —Å–≤–æ–±–æ–¥–Ω—ã–º
                for (let i = 0; i < BOARD_SIZE * BOARD_SIZE; i++) {
                    if (gameState.playerGrid[i] === 0) {
                        huntTargets.push(i);
                    }
                }
            }
            
            return huntTargets[Math.floor(Math.random() * huntTargets.length)];
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ç–æ–ø–ª–µ–Ω–∏—è –∫–æ—Ä–∞–±–ª—è
        function checkShipSunk(ships, hitIndex, side) {
            for (const ship of ships) {
                if (!ship || ship.sunk) continue;
                
                if (ship.coords.includes(hitIndex)) {
                    ship.hits++;
                    
                    if (ship.hits === ship.length) {
                        ship.sunk = true;
                        
                        // –û—Ç–º–µ—á–∞–µ–º –≤—Å–µ –∫–ª–µ—Ç–∫–∏ –∫–æ—Ä–∞–±–ª—è –∫–∞–∫ –ø–æ—Ç–æ–ø–ª–µ–Ω–Ω—ã–µ
                        for (const coord of ship.coords) {
                            if (side === 'enemy') {
                                gameState.enemyGrid[coord] = 4;
                                gameState.enemySunkCount++;
                            } else {
                                gameState.playerGrid[coord] = 4;
                                gameState.playerSunkCount++;
                                
                                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ò–ò –ø—Ä–∏ –ø–æ—Ç–æ–ø–ª–µ–Ω–∏–∏ –∫–æ—Ä–∞–±–ª—è –∏–≥—Ä–æ–∫–∞
                                aiState.mode = 'hunt';
                                aiState.hits = [];
                                aiState.lastHit = null;
                            }
                        }
                        
                        const sunkBy = side === 'enemy' ? '–í—ã –ø–æ—Ç–æ–ø–∏–ª–∏' : '–ò–ò –ø–æ—Ç–æ–ø–∏–ª';
                        addLogEntry(`${sunkBy} –∫–æ—Ä–∞–±–ª—å –¥–ª–∏–Ω–æ–π ${ship.length} –ø–∞–ª—É–±!`);
                        updateSunkCount();
                    }
                    break;
                }
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–±–µ–¥—ã
        function checkVictory() {
            const enemyShipsSunk = gameState.enemyShips.filter(ship => ship && ship.sunk).length;
            const playerShipsSunk = gameState.playerShips.filter(ship => ship && ship.sunk).length;
            
            if (enemyShipsSunk === SHIPS_CONFIG.length) {
                showVictoryModal(true);
                gameState.gameStarted = false;
                return true;
            }
            
            if (playerShipsSunk === SHIPS_CONFIG.length) {
                showVictoryModal(false);
                gameState.gameStarted = false;
                return true;
            }
            
            return false;
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–±–µ–¥—ã/–ø–æ—Ä–∞–∂–µ–Ω–∏—è
        function showVictoryModal(isWin) {
            victoryTitleEl.textContent = isWin ? 'üéâ –ü–æ–±–µ–¥–∞!' : 'üíÄ –ü–æ—Ä–∞–∂–µ–Ω–∏–µ';
            victoryTitleEl.className = `victory-title ${isWin ? 'win' : 'lose'}`;
            victoryMessageEl.textContent = isWin 
                ? '–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –ø–æ—Ç–æ–ø–∏–ª–∏ –≤—Å–µ –∫–æ—Ä–∞–±–ª–∏ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞!' 
                : '–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –ò–ò –ø–æ—Ç–æ–ø–∏–ª –≤—Å–µ –≤–∞—à–∏ –∫–æ—Ä–∞–±–ª–∏.';
            
            victoryModalEl.classList.add('show');
            
            gameStateEl.textContent = '–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞';
            subStateEl.textContent = isWin ? '–í—ã –ø–æ–±–µ–¥–∏–ª–∏!' : '–í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏';
            turnIndicatorEl.style.display = 'none';
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –≤—Å–µ—Ö –∫–æ—Ä–∞–±–ª–µ–π
        function checkAllShipsPlaced() {
            const placedShips = gameState.playerShips.filter(ship => ship != null).length;
            if (placedShips === SHIPS_CONFIG.length) {
                gameState.isPlacing = false;
                gameStateEl.textContent = '–ì–æ—Ç–æ–≤ –∫ –±–æ—é';
                subStateEl.textContent = '–ù–∞–∂–º–∏—Ç–µ "–ù–∞—á–∞—Ç—å –∏–≥—Ä—É"';
                startBtn.disabled = false;
                addLogEntry('–í—Å–µ –∫–æ—Ä–∞–±–ª–∏ —Ä–∞–∑–º–µ—â–µ–Ω—ã! –ú–æ–∂–Ω–æ –Ω–∞—á–∏–Ω–∞—Ç—å –∏–≥—Ä—É.');
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ —Ö–æ–¥–∞
        function updateTurnIndicator() {
            if (!gameState.gameStarted) {
                turnIndicatorEl.style.display = 'none';
                return;
            }
            
            turnIndicatorEl.style.display = 'flex';
            if (gameState.isPlayerTurn) {
                turnIndicatorEl.className = 'turn-indicator player';
                turnIndicatorEl.innerHTML = '<i class="fas fa-user"></i> –í–∞—à —Ö–æ–¥';
            } else {
                turnIndicatorEl.className = 'turn-indicator ai';
                turnIndicatorEl.innerHTML = '<i class="fas fa-robot"></i> –•–æ–¥ –ò–ò';
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –ø–æ—Ç–æ–ø–ª–µ–Ω–Ω—ã—Ö –∫–æ—Ä–∞–±–ª–µ–π
        function updateSunkCount() {
            sunkCountEl.textContent = gameState.enemySunkCount;
        }

        // –°–±—Ä–æ—Å –∏–≥—Ä—ã
        function resetGame() {
            gameState = {
                playerGrid: new Array(BOARD_SIZE * BOARD_SIZE).fill(0),
                enemyGrid: new Array(BOARD_SIZE * BOARD_SIZE).fill(0),
                playerShips: [],
                enemyShips: [],
                isPlacing: true,
                selectedShipIndex: null,
                shipOrientation: 'horizontal',
                gameStarted: false,
                isPlayerTurn: true,
                enemySunkCount: 0,
                playerSunkCount: 0
            };

            aiState = {
                mode: 'hunt',
                targets: [],
                lastHit: null,
                hits: []
            };

            gameStateEl.textContent = '–†–∞–∑–º–µ—â–µ–Ω–∏–µ –∫–æ—Ä–∞–±–ª–µ–π';
            subStateEl.textContent = '–†–∞–∑–º–µ—Å—Ç–∏—Ç–µ –≤—Å–µ –∫–æ—Ä–∞–±–ª–∏ –Ω–∞ –ø–æ–ª–µ';
            turnIndicatorEl.style.display = 'none';
            sunkCountEl.textContent = '0';
            
            startBtn.disabled = true;
            victoryModalEl.classList.remove('show');
            
            // –†–∞–∑–º–µ—â–∞–µ–º –∫–æ—Ä–∞–±–ª–∏ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ —Å–ª—É—á–∞–π–Ω–æ
            randomPlacement(gameState.enemyGrid, gameState.enemyShips);
            
            renderShipsList();
            renderBoards();
            
            addLogEntry('–ò–≥—Ä–∞ —Å–±—Ä–æ—à–µ–Ω–∞. –†–∞–∑–º–µ—Å—Ç–∏—Ç–µ –∫–æ—Ä–∞–±–ª–∏ –Ω–∞ –ø–æ–ª–µ.');
        }

        // –ù–∞—á–∞–ª–æ –∏–≥—Ä—ã
        function startGame() {
            if (gameState.playerShips.length !== SHIPS_CONFIG.length) {
                addLogEntry('–†–∞–∑–º–µ—Å—Ç–∏—Ç–µ –≤—Å–µ –∫–æ—Ä–∞–±–ª–∏ –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –∏–≥—Ä—ã!');
                return;
            }

            gameState.gameStarted = true;
            gameState.isPlacing = false;
            gameState.isPlayerTurn = Math.random() < 0.5;
            
            gameStateEl.textContent = '–ò–¥–µ—Ç –±–æ–π';
            subStateEl.textContent = '–°—Ç—Ä–µ–ª—è–π—Ç–µ –ø–æ –ø–æ–ª—é –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞';
            
            updateTurnIndicator();
            addLogEntry('–ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å! –£–¥–∞—á–∏ –≤ –±–æ—é!');
            
            if (!gameState.isPlayerTurn) {
                setTimeout(aiTurn, 1000);
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        function setupEventListeners() {
            // –ö–ª–∏–∫–∏ –ø–æ –∏–≥—Ä–æ–≤—ã–º –ø–æ–ª—è–º
            playerBoardEl.addEventListener('click', handlePlayerBoardClick);
            enemyBoardEl.addEventListener('click', handleEnemyBoardClick);

            // –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            startBtn.addEventListener('click', startGame);
            
            randomBtn.addEventListener('click', () => {
                randomPlacement(gameState.playerGrid, gameState.playerShips);
                renderShipsList();
                renderBoards();
                checkAllShipsPlaced();
                addLogEntry('–ö–æ—Ä–∞–±–ª–∏ —Ä–∞–∑–º–µ—â–µ–Ω—ã —Å–ª—É—á–∞–π–Ω–æ');
            });
            
            clearBtn.addEventListener('click', () => {
                gameState.playerGrid.fill(0);
                gameState.playerShips.length = 0;
                gameState.selectedShipIndex = null;
                gameState.isPlacing = true;
                startBtn.disabled = true;
                
                gameStateEl.textContent = '–†–∞–∑–º–µ—â–µ–Ω–∏–µ –∫–æ—Ä–∞–±–ª–µ–π';
                subStateEl.textContent = '–†–∞–∑–º–µ—Å—Ç–∏—Ç–µ –≤—Å–µ –∫–æ—Ä–∞–±–ª–∏ –Ω–∞ –ø–æ–ª–µ';
                
                renderShipsList();
                renderBoards();
                addLogEntry('–ü–æ–ª–µ –∏–≥—Ä–æ–∫–∞ –æ—á–∏—â–µ–Ω–æ');
            });
            
            rotateBtn.addEventListener('click', () => {
                gameState.shipOrientation = gameState.shipOrientation === 'horizontal' ? 'vertical' : 'horizontal';
                const orientationText = gameState.shipOrientation === 'horizontal' ? '–≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ' : '–≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ';
                addLogEntry(`–û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è –∫–æ—Ä–∞–±–ª–µ–π: ${orientationText}`);
            });
            
            restartBtn.addEventListener('click', () => {
                resetGame();
            });
            
            playAgainBtn.addEventListener('click', () => {
                resetGame();
            });

            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –µ–≥–æ
            victoryModalEl.addEventListener('click', (e) => {
                if (e.target === victoryModalEl) {
                    victoryModalEl.classList.remove('show');
                }
            });
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function initGame() {
            createBoard(playerBoardEl, 'player');
            createBoard(enemyBoardEl, 'enemy');
            resetGame();
            setupEventListeners();
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –∑–∞–≥—Ä—É–∑–∫–∏
            setTimeout(() => {
                document.querySelectorAll('.loading').forEach(el => {
                    el.style.animationDelay = Math.random() * 0.3 + 's';
                });
            }, 100);
        }

        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>